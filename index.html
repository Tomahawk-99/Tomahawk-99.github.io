<!DOCTYPE html>
<html>
  <head>
	  <title>[CLWO] TTT Dashboard</title>
	<!--Import Google Icon Font-->
	<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
	<link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
	<link type="text/css" rel="stylesheet" href="css/main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  </head>

  <body>

    <!--Navbar-->
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper">
				<a href="#" data-target="mobile-demo" class="sidenav-trigger right show-on-large"><i class="material-icons burger">menu</i></a>
				<a href="#" data-target="mobile-demo" class="sidenav-trigger"><span class="logo">CLWO.EU</span></a>
              	<ul id="nav-mobile" class="left hide-on-med-and-down">
					<li><a href="https://clwo.eu/" class="logo"><span class="logo-span">CLWO.EU</span></a></li>
					<li><a href="index.html"><i class="material-icons left">dashboard</i><span>QUICK DASH</span></a></li>
					<li><a href="player-profile.html"><i class="material-icons left">account_box</i><span>player profile</span></a></li>
                	<li><a href="karma-leaderboard.html"><i class="material-icons left">grade</i><span>KARMA LEADERBOARD</span></a></li>
					<li><a href="shop-stats.html"><i class="material-icons left">shopping_cart</i><span>SHOP STATS</span></a></li>
                	<li><a href="https://staff.aimless.eu/cases/"><i class="material-icons left">trending_up</i><span>RDM CASE TRACKER</span></a></li>
					<li><a href="https://clwo.eu/forum-38.html"><i class="material-icons left">forum</i><span>TTT FORUMS</span=></a></li>
					<li><a href="https://clwo.eu/ttt/sourcebans/"><i class="material-icons left">gavel</i><span>TTT bans</span=></a></li>
              	</ul>
            </div>
          </nav>
	</div>
	
	<!--Sidebar-->
	<div class="sidebar">
		<ul class="sidenav" id="mobile-demo">
			<li><a href="index.html"><i class="material-icons left">dashboard</i><span>QUICK DASH</span></a></li>
			<li><a href="player-profile.html"><i class="material-icons left">account_box</i><span>player profile</span></a></li>
			<li><a href="karma-leaderboard.html"><i class="material-icons left">grade</i><span>KARMA LEADERBOARD</span></a></li>
			<li><a href="shop-stats.html"><i class="material-icons left">shopping_cart</i><span>SHOP STATS</span></a></li>
			<li><a href="https://staff.aimless.eu/cases/"><i class="material-icons left">trending_up</i><span>RDM CASE TRACKER</span></a></li>
			<li><a href="https://clwo.eu/forum-38.html"><i class="material-icons left">forum</i><span>TTT FORUMS</span=></a></li>
			<li><a href="https://clwo.eu/ttt/sourcebans/"><i class="material-icons left">gavel</i><span>TTT bans</span=></a></li>
		  </ul>
	</div>
	
	<div class="container row">
		<div class="section col m3 hide-on-med-and-down">
			<div class="card">
				<img class="responsive-img" src="images/clwologo.png" style="width: 235px; height: 75px; padding-left: 1rem;">
				<div class="card-content">
				  <p>THE BE ALL, KNOW SOURCE
					FOR ALL TTT STATS & INFO!</p>
				</div>
				<div class="card-action">
					<div class="card">
						<img src="images/csgologo.png" alt="" class="responsive-img">
					</div>
					<a class="btn" href="steam://connect/ttt.clwo.eu:27015" style="margin-left: 2rem;">
						<i class="material-icons left">launch</i>
						Join server :
						<span class="" id="playercount"></span>
						<span class="" >/24</span>
					</a>
				</div>
				<div class="divider"></div>
				<footer style="margin-left: 2rem;">
					<ul>
						<li><a href="https://clwo.eu/misc.php?action=syndication"><i class="material-icons" style="height: 100%;">rss_feed</i><span>RSS</span></a></li>
						<li><a href="https://clwo.eu/archive/index.php"><i class="material-icons">reorder</i><span>Lite mode</span></a></li>
						<li><a href="https://clwo.eu/contact.php"><i class="material-icons">mail</i><span>Contact Us</span></a></li>
					</ul>
					<span class="credits" style="margin-left: 5px;">DEVELOPED BY <a href="https://github.com/Tomahawk-99/">TOMAHAWK</a> FOR <a href="https://clwo.eu/">CLWO</a></span>
				</footer>
			  </div>
		</div>
		<div class="section dash col l9 m12">
			<div class="panel-header">
				<h2>Quick Glance</h2>
				<span class="card-subtitle">HERE'S A GLANCE AT What's happened Recently</span>
			</div>
			<div class="divider"></div>
			<div class="row">
				<div class="card col m6 s12 left">
					<div class="card-content center-align">
						<span class="table-header">Latest Purchases</span>
						<table id="latestPurchases" class="highlight">
							<tbody id="purchaseData"></tbody>
						</table>
					</div>
					<div class="card-action center-align" style="border-top: none;">
						<a class="btn-flat more_info" href="shop-stats.html" style="padding-left: 1rem; margin: auto">
							More shop stats
						</a>
					</div>
				</div>
				<div class="card col m6 s12 left">
					<div class="card-content center-align">
						<span class="table-header">Top players this month</span>
						<table id="karmaLeaderboard" class="highlight">
							<tbody id="karmaData"></tbody>
						</table>
					</div>
					<div class="card-action center-align" style="border-top: none;">
						<a class="btn-flat more_info" href="karma-leaderboard.html" style="padding-left: 1rem; margin: auto">
							More karma stats
						</a>
					</div>
				</div>
			</div>
		</div>
    </div>
    <!--JavaScript at end of body for optimized loading-->
	<script type="text/javascript" src="js/materialize.min.js"></script>
	<script type="text/javascript" src="js/auto-init.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript">
	function Get(yourUrl){
		var Httpreq = new XMLHttpRequest(); // a new request
		Httpreq.open("GET",yourUrl,false);
		Httpreq.send(null);
		return Httpreq.responseText;          
	}

	var json_obj = JSON.parse(Get('https://clwo.eu/jailbreak/api/v2/ttt_shopstats.php'));
	var last_purchases = json_obj.data.LastPurchaseDateTime.data;
	var purchase_index = [];
	json_obj = JSON.parse(Get('https://clwo.eu/jailbreak/api/v2/ttt_karma.php'));
	var top_karma = json_obj.data;

	function lastPurchasesTable() {
		var d = new Date();
		var n = d.getTimezoneOffset();
		for (var item in last_purchases) {
				purchase_index.push(item);
		}
		const table = document.getElementById("purchaseData");
		var i;
		for(i=0; i<8; i++) {
			var key = purchase_index[i];
			let row = table.insertRow();
			let item = row.insertCell(0);
			item.innerHTML = key;
			let time = row.insertCell(1);
			var purchase_time = String(Number(last_purchases[key].substring(11, 13))+1)+last_purchases[key].substring(13, 16);
			time.innerHTML = purchase_time;
		}
	}

	function topMonthKarmaTable(){
		const table = document.getElementById("karmaData");
		for(var i = 0; i < 8; i++) {
			var player = top_karma[i];
			var json_player= JSON.parse(Get('https://clwo.eu/jailbreak/api/v2/accounthelper.php?AccountID='+player.AccountID));
			var player_profile = json_player.SteamData;
			let row = table.insertRow();
			let pfp = row.insertCell(0);
			pfp.innerHTML = '<img src="'+player_profile.avatarfull+'" alt="" width="30px" height="30px">';
			let account = row.insertCell(1);
			console.log();
			account.innerHTML = '<a href="'+player_profile.profileurl+'" class="truncate" style="padding-left: 5px;">'+player_profile.personaname+'</a>';
			let karma = row.insertCell(2);
			karma.innerHTML = player.Karma;
		}
	}

	lastPurchasesTable();
	topMonthKarmaTable();
	</script>
	<script type="text/javascript" src="js/player-count.js"></script>
	
    </body>
  
</html>